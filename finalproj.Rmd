title: "stats15final"
output:
  pdf_document: default
date: "2022-12-08"
---
FEEL FREE TO CHANGE ANYTHING UP HERE IN THE INTRODUCTION

IMPORTANT: WHEN PUSHING TO GITHUB, DONT COMMIT TO MAIN!!!!! MAKE A BRANCH!!!
IF YOU DONT KNOW HOW, READ HERE: https://docs.github.com/en/get-started/quickstart/github-flow

---------------------------------------

# Section 1: Background and Explanation of Data

## Introduction and Motivating Question

In the United States alone, 6.5 million dogs, cats, and other former pets are abandoned or lost every year and end up in shelters. In reality, only 3.2 million of these animals are adopted, while others who are not adopted within a certain time frame are euthanized. The Austin Animal Center, however, objects to this quota by being the largest no-kill animal shelter in the United States and providing care and shelter to over 18,000 animals each year. In contrast to other shelters, the animals that are not adopted within a certain time period are either transferred, returned to their original owner, and in very rare cases, euthanized. In this project, we will seek to answer the motivating question: what attributes affect whether a dog is adopted?

## Background

### The Austin Animal Center
The Austin Animal Center is the largest no-kill animal shelter in the United States that provides care and shelter to over 18,000 animals annually. They accept strays and owned animals regardless of age or health, and they accept all species and breeds of animals. However, for our analysis, we will be solely looking at the intake and outcomes of dogs at the center. As part of the AAC's efforts to help and care for animals in need, the organization makes available its accumulated data and statistics as part of the city of Austin's Open Data Initiative. The AAC datasets that we will be analysing outline the intakes and outcomes of animals at the center, of which many happen each day.

### Intakes and Outcomes
An _intake_ refers to an instance of an animal being admitted to the shelter, whether it be stray or owned. An _outcome_ refers to an animal leaving the shelter for any reason, whether they are adopted, transferred to another shelter, or pass away while staying in the shelter. Our data consists of two separate tables, one detailing outcomes and one detailing intakes. Each animal has a unique ID that is shared between the two tables.

### How Animals Come Into the Shelter
Some are brought in by owners who can no longer keep the animals. Others are found roaming the streets and brought in by animal control officers. In an ideal situation, an animal will only stay in a shelter until its owner returns or it is adopted. However, if that is not the case and they don't have enough room to indefinitely house all of the animals they receive, they will transfer them to a partner location.

### Data Structure
The intakes table has one entry for each instance of an animal coming into the shelter, and the outcomes table has one entry for each instance of an animal leaving the shelter. Each entry has details about the intake and outcome situations for the animals, which are specified in the "Variables" section. In our dataset, we will only be looking at dogs. Before any cleaning, the intakes and outcomes tables had a total of 145,851 entries and 145,914 entries, respectively, with 12 variables each.

### Importance of the Data
The importance of this data lies in the fact that it not only identifies characteristics people are looking for in dogs but also helps shelters that house dogs of all kinds decide whether to keep animals that exhibit certain characteristics at their current location or move them to a shelter that specializes in such characteristics. Suppose an elderly dog was staying at a shelter that couldn't get adopted due to a trend of people not adopting elderly dogs. If this was the case, the shelter might be better off transferring the dog to a shelter that is specifically designed for elderly dogs, where people looking to adopt elderly dogs are more likely to adopt the dog.


## Variables

+ Note: the variables started off as being in two separate tables, but the tables will be binded together during cleaning

### Explanatory Variables

***Age.upon.Intake*** and ***Age.upon.Outcome***: (char) the dog’s age at the time of the intake/outcome; an estimate if the dog is a rescue

***Breed***: (char) the dog’s primary and secondary breed (if it has one)

***Color***: (char) the dog’s primary and secondary color (if it has one); the one or two main colors that make up its coat

***DateTime***: (char) the date and time of the intake/outcome

### Response Variable

***Intake.Type*** and ***Outcome.Type***: (char)  the specifics of the intake/outcome situation for the dog, which are: 

outcomes: Adoption, Return to Owner, Transfer (moved to a rescue shelter), Euthanasia, Rto-Adopt (returned to the original owner through the adopotion process), Died, Disposal (same as died), Missing (the dog was lost at the center), and Stolen

intakes: Stray, Owner Surrender, Public Assist (the dog was brought to the shelter by an outside rescue org), Abandoned (there was a confirmed past owner that has abandoned the dog), Euthanasia Request (from the owner or otherwise), and Wildlife (same as stray)

# Section 2: Data Loading and Cleaning

```{r, message=FALSE, echo=FALSE}
library(tidyverse)
library(ggplot2)
library(lubridate)
library(forcats)
```

First, we load our data in.

```{r}
austin_intakes <- read.csv("aac_intakes.csv")
austin_outcomes <- read.csv("aac_outcomes.csv")
```

Then, we of course need to limit our dataset to just dogs.

```{r}
outcomes_filter <- austin_outcomes %>%
  filter(Animal.Type=="Dog")
intakes_filter <- austin_intakes %>% 
  filter(Animal.Type=="Dog")
outcomes_filter %>%
  select(Age.upon.Outcome, Animal.Type, Breed) %>%
  head()
```

Then, we need to eliminate all of the unused columns. The `Animal.Type` column will be unused since we've already filtered to just dogs.

```{r}
outcomes_s <- outcomes_filter %>%
  select(Animal.ID, Age.upon.Outcome, Breed, Color, DateTime, Outcome.Type)
intakes_s <- intakes_filter %>%
  select(Animal.ID, Age.upon.Intake, Breed, Color, DateTime, Intake.Type)
outcomes_s %>% 
  select(Age.upon.Outcome, Breed, Color) %>%
  head()
```

Then, we'll be binding the two tables together for the sake of analysis. An extra column will be added that will specify if each entry is an outcome/intake.

```{r}
o1 <- outcomes_s %>%
  rename("Age"="Age.upon.Outcome",
         "Type"="Outcome.Type")
o1$Action <- "outcome"
i1 <- intakes_s %>%
  rename("Age"="Age.upon.Intake",
         "Type"="Intake.Type")
i1$Action <- "intake"
aac <- rbind(o1, i1) %>% arrange(Animal.ID)
aac %>%
  select(Age, Breed, Color) %>%
  head()
```

Now, there is some cleaning to do in the `Type` column: some outcome/intake types are very similar to each other, and it will make more sense for our analysis if we lump them all together. Specifically, 

+ `Rto-Adopt` is the same as `Return to Owner`
+ `Wildlife` and `Abandoned` are the same as `Stray`
+ `Disposal` is the same as `Died`
+ `Stolen` is the same as `Lost`.

```{r}
aac <-
  aac %>%
  mutate(Type=case_when(
    Type=="Rto-Adopt" ~ "Return to Owner",
    Type=="Stolen" ~ "Lost",
    Type=="Disposal" ~ "Died",
    Type %in% c("Wildlife", "Abandoned") ~ "Stray",
    Type==Type ~ Type
  ))
```

Then, we'll use `lubridate` to add a column for all of the `DateTime` values converted to `date` instead of `char` objects, which will make it easier to compare them.

```{r}
aac <- aac
aac$DateTime <- mdy_hms(aac$DateTime)
aac$DateTime %>%
  head(3)
```

Next, note that the `Age` column is made up of character strings at the moment.

```{r}
aac$Age %>%
  head()
```

Such a variable will be much easier to analyse as an integer, so we will convert these to integers representing the dog's age in days.

```{r}
conv_to_int <- function(string)
{
  conv <- data.frame(
    c("week", "month", "year"),
    c(7, 30, 365)
  )
  tmp <- 1
  for (n in (1:3))
  {
     if(str_detect(string, conv[n, 1]))
    {
      tmp <- conv[n, 2]
    } 
  }
  ret_str <- str_extract(string, "^[0-9]+")
  ret_int <- as.integer(ret_str)
  return(as.integer(ret_int*tmp))
}
aac$Age.Days <- map_int(aac$Age, conv_to_int)
aac <- aac %>%
  select(-c(Age)) %>%
  relocate(Age.Days, .before=Breed)
         
aac$Age.Days %>%
  head()
```

Then, we'll simply remove all duplicate entries in our dataset.

```{r}
aac <- aac[!(duplicated(aac)), ]
```

Lastly, we'll be implementing a new column to denote the time between the last action and the one in the entry. The first entry for each dog will have an `NA` in this column.

```{r}
len <- function(d1, d2)
{
  retval <- int_length(interval(d1, d2))
  return(retval)
}
aac <-
aac %>%
  arrange(Animal.ID, DateTime) %>%
  group_by(Animal.ID) %>%
  mutate(Num.Action=row_number()) %>%
  ungroup() %>%
  mutate(Time.From.Last.Action=case_when(
    (Num.Action > 1) ~ len(lag(DateTime), DateTime)
  )) %>%
  select(-c(Num.Action))
aac %>%
  select(Animal.ID, Action, Time.From.Last.Action) %>%
  head()
```

# Section 2.1: Univariate Exploratory Analysis

## Breed

To start, we'll be looking at the `Breed` column.

It currently has the problem of being a bit too specific, where some breeds are unmixed, some are just labeled "Mix" while others have the breed mix specified, among other naming specifics; this leads to a large majority of the breed categories having <10 entries.

```{r}
aac %>%
  group_by(Breed) %>%
  summarise(n=n()) %>%
  ggplot(aes(x=n)) +
  geom_density(fill="light blue") +
  scale_x_log10() +
  xlab("Occurances of each unique breed in data")
aac %>%
  group_by(Breed) %>%
  summarise(n=n()) %>%
  summarise(breeds=n())
```

In order for our analysis to be a bit more useful, it will helpful to create less breed categories; we will be removing any "mix" labels and specifying all dogs by their primary breed.

```{r}
aac <- aac %>% 
  mutate(Breed=str_extract(Breed, "^[A-Za-z ]+")) %>% 
  mutate(Breed=str_replace(Breed, " Mix", ""))
aac %>%
  group_by(Breed) %>%
  summarise(n=n()) %>%
  ggplot(aes(x=n)) +
  geom_density(fill="light blue") +
  scale_x_log10() +
  xlab("Occurances of each unique breed in data")
aac %>%
  group_by(Breed) %>%
  summarise(n=n()) %>%
  summarise(breeds=n())
aac %>%
  select(Age.Days, Breed, Color) %>%
  head()
```

While there are still some breeds that show up <10 times, they now make up a minority of the data, and our analysis will be far more useful.

Let's look at the distribution of breeds in the data after modification.

```{r}
aac %>%
  group_by(Breed) %>%
  summarise(n=n()) %>%
  ggplot(aes(x=fct_rev(fct_reorder(Breed, n)), y=n)) + geom_col(fill="light blue", color="black")  +
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank()) +
  ylab("Appearances in Data") +
  ggtitle("breeds vs how often they appear in the data")
```

The distribution of breeds throughout the data appears *very* right skewed, so there are a small number of breeds that show up far more than any others. Let's look at those at the top:

```{r}
aac %>%
  group_by(Breed) %>%
  summarise(appearances=n()) %>%
  arrange(desc(appearances)) %>%
  head(10)
```

Unsurprisingly, Pit Bulls appear most often in the data, appearing in 24,799 entries out of 163,450 total entries (i.e. nearly a sixth). Pit Bulls are very common in animal shelters, since they tend to have a hard time finding owners due to the aggressive and dangerous reputation of the breed, and they are often abandoned by their owners for the same reason. Retrievers are not far behind Pit Bulls, however dogs of the breed are far more numerous than Pit Bulls, which can account for their many occurrences in the data.

## Action Type

Let's look at the distribution of action types in the data.

```{r}
aac %>%
  ggplot(aes(x=Type)) +
  geom_bar(fill="light blue", color="black") + 
  facet_wrap(~ Action, scale="free_x") +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
n_o <- (filter(aac, Action=="outcome") %>% summarise(n=n()))[1,1]
n_i <- (filter(aac, Action=="intake") %>% summarise(n=n()))[1,1]
aac %>%
  filter(Action=="outcome") %>%
  group_by(Type) %>%
  summarise(percent_of_outcomes=round((n()/n_o)*100, 2))
aac %>%
  filter(Action=="intake") %>%
  group_by(Type) %>%
  summarise(percent_of_intakes=round((n()/n_i)*100, 2))
```

We can see that almost 50% of the dogs that leave the shelter are adopted, and well over 50% that enter are strays. Considering the findings from our analysis of the `Breed` column, it may be interesting to facet further by `Breed` comparing Pit Bulls and Retrievers, since they both appear very frequently in the data but likely for different reasons.

```{r}
aac %>%
  filter(Breed %in% c("Pit Bull", "Labrador Retriever")) %>%
  ggplot(aes(x=Type)) +
  geom_bar(fill="light blue", color="black") + 
  facet_grid(Breed ~ Action, scale="free_x") +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
n_o_r <- (filter(aac, Action=="outcome", Breed=="Labrador Retriever") %>% summarise(n=n()))[1,1]
n_i_r <- (filter(aac, Action=="intake", Breed=="Labrador Retriever") %>% summarise(n=n()))[1,1]
n_o_p <- (filter(aac, Action=="outcome", Breed=="Pit Bull") %>% summarise(n=n()))[1,1]
n_i_p <- (filter(aac, Action=="intake", Breed=="Pit Bull") %>% summarise(n=n()))[1,1]
aac %>%
  filter(Action=="outcome", Breed %in% c("Labrador Retriever", "Pit Bull")) %>%
  group_by(Type) %>%
  summarise(percent_of_outcomes_LR=round((sum(Breed=="Labrador Retriever")/n_o_r)*100, 2),
            percent_of_outcomes_PB=round((sum(Breed=="Pit Bull")/n_o_p)*100, 2))
aac %>%
  filter(Action=="intake", Breed %in% c("Labrador Retriever", "Pit Bull")) %>%
  group_by(Type) %>%
  summarise(percent_of_intakes_LR=round((sum(Breed=="Labrador Retriever")/n_i_r)*100, 2),
            percent_of_intakes_PB=round((sum(Breed=="Pit Bull")/n_i_p)*100, 2))
```

Indeed, while about 53% of Retrievers' outcomes are adoptions, only about 43% of Pit Bulls' outcomes are adoptions: a difference of 10%! Conversely, "return to owner" for Retrievers was 10% greater than that for Pit Bulls. 

Additionally, while the actual difference is only about 3%, the percentage of outcomes for Pit Bulls that were euthanasia is around 2.5 times greater than that for Retrievers. All of these differences can be attributed to the aggressive reputation that Pit Bulls carry (or, in some cases such as euthanasia, the aggressive temperament they have).

## Age

Let's look at the distribution of ages throughout the data.

```{r}
aac %>%
  ggplot(aes(x=Age.Days)) + 
  geom_histogram(fill="light blue", color="black", bins=20) +
  xlab("age in days") +
  ggtitle("distribution of ages in days in the data")
```

The ages are certainly right-skewed, but it may be useful to dig deeper. The age may be somewhat dependent on what is happening to the dog, so we'll facet by `Type` and see if it's any different.

```{r}
aac %>%
  ggplot(aes(x=Age.Days)) + 
  geom_histogram(fill="light blue", color="black", bins=20) +
  xlab("age in days") +
  ggtitle("distribution of ages in days in the data") +
  facet_wrap(~ Type, scales="free")
```

The only distribution that is not right-skewed is `Euthanasia Request`, reflecting how the one of the main reasons older dogs come in is for euthanasia; many dogs come into the shelter because the owner loses or abandons them, and this is more likely to happen if the dog is younger, since they have more energy they are more likely to run away or the owner may feel that they cannot take care of them. 

It may be useful to bin the dogs' ages in categories for later. A numerical distribution may better help us understand how to bin them.

```{r}
quantile(aac$Age.Days, na.rm=TRUE)
```

## Color

[stuff]

## Time from last Action

```{r}
aac %>%
  filter(Type == "Adoption") %>%
  mutate(Age.Years = as.integer(Age.Days/365)) %>%
  filter(Time.From.Last.Action > 0) %>%
  group_by(Age.Years) %>%
  summarize(Avg_TFLA = mean(Time.From.Last.Action)) %>%
  ggplot(aes(x=Age.Years)) + 
  geom_col(aes(y=Avg_TFLA), color = "black", fill = "light blue", ) +
  ggtitle('Average Time at Shelter Until Adoption Based on Dog Age')
```
From this we see that the dogs that are younger get adopted faster. The exceptions that we see above the age of 16, may be attributed to dogs that are brought to the shelter when they are older, whether that is through transfer, public assist, stray or owner surrender.

```{r}
aac %>%
  filter(Time.From.Last.Action >0) %>% 
  filter(Type == "Adoption" | Type == "Euthanasia" | Type == "Return to Owner") %>%
  group_by(Type) %>%
  summarize(Avg_TFLA = mean(Time.From.Last.Action)) %>%
  ggplot(aes(x = Type)) +
  geom_col(aes(y = Avg_TFLA), fill="light blue", color="black") + 
  ggtitle('Average Actions taken')
```

It takes longer time for dogs to be adopted than for it to be euthanize because the shelter needs time to find a proper owner for the dog. If a dog is sick or old when it comes into the shelter, it may be a clearer and quicker decision to euthanize it. Owners who are actively looking for lost pets will find them and the dog will be returned quicker than if it needed to be adopted.

```{r}
aac %>%
  filter(Time.From.Last.Action >0) %>% 
  filter(Type == "Adoption") %>%
  filter(n() >=15)%>%
  group_by(Color) %>%
  summarize(Avg_TFLA = mean(Time.From.Last.Action)) %>%
  arrange(desc(Avg_TFLA)) %>%
  head(20) %>%
  ggplot(aes(x = Color)) +
  geom_col(aes(y = Avg_TFLA), fill="light blue", color="black") + 
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  ggtitle("Greatest Time to Adoption Based on Color")
  
aac %>%
  filter(Time.From.Last.Action >0) %>% 
  filter(Type == "Adoption") %>%
  group_by(Color) %>%
  summarize(Avg_TFLA = mean(Time.From.Last.Action)) %>%
  arrange(desc(Avg_TFLA)) %>%
  tail(20) %>%
  ggplot(aes(x = Color)) +
  geom_col(aes(y = Avg_TFLA), fill="light blue", color="black") + 
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  ggtitle("Least Time to Adoption Based on Color")
```
We can conclude that in regards to color, typically the darker the dog is the longer the time is to adopt. As shown in the Greatest time to adopt, the top 20 colors are mainly darker less exotic colors. On the other end of the spectrum we see mixed light and dark or just lighter colored dogs take the least amount of time to adopt.

```{r}
aac %>%
  filter(Type == "Adoption") %>%
  mutate(Age.Years = as.integer(Age.Days/365)) %>%
  filter(Time.From.Last.Action > 0) %>%
  group_by(Age.Years) %>%
  summarize(Avg_TFLA = mean(Time.From.Last.Action)) %>%
  ggplot(aes(x=Age.Years)) + 
  geom_col(aes(y = Avg_TFLA), color = "black", fill = "light blue") + 
  ggtitle('Average Time at Shelter Until Adoption Based on Dog Age')
  
aac %>%
  mutate(Age.Years = as.integer(Age.Days/365)) %>%
  filter(Age.Years >= 17) %>%
  filter(Type == "Adoption")
```

From this we see that the dogs that are younger get adopted faster, and the dogs that are older have been at the shelter a while and therefore the average time before their adoption is larger. The outliers to this are popular or specialty dogs.



# Section 2.2: Multivariate Exploratory Analysis

## Breed vs Time Spent in Shelter

It may be interesting to see if certain breeds spend more time in the shelter than others before being adopted. Since we will be taking an average of the time the breed spends in the shelter, we will only be looking at breeds with at least 15 adoption entries.

```{r}
aac %>%
  filter(!(is.na(Time.From.Last.Action))) %>%
  filter(Action=="outcome", Type=="Adoption") %>%
  group_by(Breed) %>%
  filter(n()>=15) %>%
  summarise(a=mean(Time.From.Last.Action)) %>%
  ggplot(aes(x=fct_rev(fct_reorder(Breed, a)), y=a)) + geom_col(fill="light blue", color="black")  +
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank()) +
  ylab("Avg Time Spent in Center") +
  ggtitle("breeds vs time spent in shelter before adoption")
```

We see a skew, though not as intensely as the distribution of breeds throughout the data. There are some that stick out, so let's look at the ones at the top.

```{r}
aac %>%
  filter(!(is.na(Time.From.Last.Action))) %>%
  filter(Action=="outcome", Type=="Adoption") %>%
  group_by(Breed) %>%
  summarise(avg_days_before_adoption=mean(Time.From.Last.Action)/86400) %>%
  arrange(desc(avg_days_before_adoption)) %>%
  head(10)
```

If you're unfamiliar with dog breeds then the `Dogo Argentino` may seem random, but its appearance actually closely resembles that of a Pit Bull.

![a Dogo Argentino on the left, and a Pit Bull on the right](./dogoargentino.jpg)

While the two breeds are actually not related genetically, they are often mistaken for each other. Thus, it suffers from the same bad rap that the Pit Bull has of being a dangerous breed. **In fact, 9/10 of the breeds in that top 10 are relatives of the Pit Bull, or breeds that look similar**. Only the Beauceron looks distinct from a Pit Bull, and it likely has such a high average time because it looks similar to the Doberman, another breed with an "aggressive" reputation.

Looking into the breeds at the tail end of the graph may give us some insight, as well.

```{r}
aac %>%
  filter(!(is.na(Time.From.Last.Action))) %>%
  filter(Action=="outcome", Type=="Adoption") %>%
  group_by(Breed) %>%
  filter(n()>=15) %>%
  summarise(avg_days_before_adoption=mean(Time.From.Last.Action)/86400) %>%
  arrange((avg_days_before_adoption)) %>%
  head(10)
```

dwnjankjnwanda people like cute dogs holllyyyyy shittttttttttttt

sorry its late and im passing out ill write something here later but the point is that all of thtese dogs that get adopted quickly are small and/or look cute, the largest i think is the cocker spaniel but that has funny looking ears so its cute

# Section 3: Data Modeling

[stuff]

# Conclusion

[stuff]
